<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Riya Ponraj">

<title>CS 670 Data Science Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="dss_files/libs/clipboard/clipboard.min.js"></script>
<script src="dss_files/libs/quarto-html/quarto.js"></script>
<script src="dss_files/libs/quarto-html/popper.min.js"></script>
<script src="dss_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="dss_files/libs/quarto-html/anchor.min.js"></script>
<link href="dss_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="dss_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="dss_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="dss_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="dss_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CS 670 Data Science Project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Riya Ponraj </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This dataset provides detailed information about Airbnb listings in various West Coast cities, including Seattle, Los Angeles, San Francisco, Portland, and Salem. Sourced from publicly available data on the Inside Airbnb platform, it includes approximately 75 attributes per listing. These attributes encompass a wide range of information, such as pricing, location, room type, host details, review counts, and available amenities. The dataset includes both quantitative variables (e.g., listing price, number of reviews) and categorical variables (e.g., room type, neighborhood), making it a rich resource for various types of analyses.</p>
<p>The main purpose of Inside Airbnb is to increase transparency around Airbnb’s impact on housing markets, neighborhoods, and local economies.</p>
<p>The data is gathered by scraping Airbnb’s website. Inside Airbnb uses custom web scraping scripts to collect detailed information about all available listings in a given city on a specific date.</p>
<p>Data Source: <a href="http://insideairbnb.com/">Inside Airbnb</a></p>
</section>
<section id="code-setup" class="level2">
<h2 class="anchored" data-anchor-id="code-setup">Code Setup</h2>
<section id="import-the-required-libraries" class="level4">
<h4 class="anchored" data-anchor-id="import-the-required-libraries">Import the Required Libraries</h4>
<div id="3e073e95" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> zscore</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, LabelEncoder</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, LassoCV, RidgeCV</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> pairwise_distances</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">Data Collection:</h3>
<p>I have collected the data from Airbnb. This is how data looks like</p>
<div id="301db258" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>file_paths <span class="op">=</span> [</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\LA.csv"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\Pdx.csv"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\Salem.csv"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\Sea.csv"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\SD.csv"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D:\DS Assignment\Data\SF.csv"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> {os.path.basename(path).split(<span class="st">"."</span>)[<span class="dv">0</span>]: pd.read_csv(path) <span class="cf">for</span> path <span class="kw">in</span> file_paths}</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>datasets.keys()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>datasets[<span class="st">"LA"</span>].head() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">scrape_id</th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">neighborhood_overview</th>
<th data-quarto-table-cell-role="th">picture_url</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">review_scores_communication</th>
<th data-quarto-table-cell-role="th">review_scores_location</th>
<th data-quarto-table-cell-role="th">review_scores_value</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">instant_bookable</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count_entire_homes</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count_private_rooms</th>
<th data-quarto-table-cell-role="th">calculated_host_listings_count_shared_rooms</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>109</td>
<td>https://www.airbnb.com/rooms/109</td>
<td>20241206031821</td>
<td>2024-12-06</td>
<td>city scrape</td>
<td>Amazing bright elegant condo park front *UPGRA...</td>
<td>*** Unit upgraded with new bamboo flooring, ne...</td>
<td>NaN</td>
<td>https://a0.muscache.com/pictures/miso/Hosting-...</td>
<td>521</td>
<td>...</td>
<td>4.00</td>
<td>5.00</td>
<td>4.00</td>
<td>NaN</td>
<td>f</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0.01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2708</td>
<td>https://www.airbnb.com/rooms/2708</td>
<td>20241206031821</td>
<td>2024-12-07</td>
<td>city scrape</td>
<td>Runyon Canyon | Beau Furn Mirror Mini-Suite Fi...</td>
<td>Run Runyon Canyon, Our Gym &amp; Sauna Open &lt;br /&gt;...</td>
<td>Walk and run to Runyon Canyon, it is open!&lt;br ...</td>
<td>https://a0.muscache.com/pictures/40618141/2ac0...</td>
<td>3008</td>
<td>...</td>
<td>4.98</td>
<td>4.95</td>
<td>4.86</td>
<td>NaN</td>
<td>t</td>
<td>2</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0.34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2732</td>
<td>https://www.airbnb.com/rooms/2732</td>
<td>20241206031821</td>
<td>2024-12-07</td>
<td>city scrape</td>
<td>Zen Life at the Beach</td>
<td>An oasis of tranquility awaits you.</td>
<td>This is the best part of Santa Monica. Quiet, ...</td>
<td>https://a0.muscache.com/pictures/1082974/0f74c...</td>
<td>3041</td>
<td>...</td>
<td>4.48</td>
<td>4.91</td>
<td>4.22</td>
<td>228269</td>
<td>f</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0.15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2864</td>
<td>https://www.airbnb.com/rooms/2864</td>
<td>20241206031821</td>
<td>2024-12-07</td>
<td>previous scrape</td>
<td>* Beautiful Master Suite/Jacuzzi Tub/*</td>
<td>Centrally located.... Furnished with King Size...</td>
<td>What makes the neighborhood unique is that the...</td>
<td>https://a0.muscache.com/pictures/23817858/de20...</td>
<td>3207</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>f</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>6033</td>
<td>https://www.airbnb.com/rooms/6033</td>
<td>20241206031821</td>
<td>2024-12-07</td>
<td>previous scrape</td>
<td>Poolside Serenity Studio</td>
<td>Our distinctive bachelor's studio for 1-3 gues...</td>
<td>NaN</td>
<td>https://a0.muscache.com/pictures/458111/986c76...</td>
<td>11619</td>
<td>...</td>
<td>4.35</td>
<td>4.65</td>
<td>4.29</td>
<td>NaN</td>
<td>f</td>
<td>7</td>
<td>3</td>
<td>3</td>
<td>1</td>
<td>0.11</td>
</tr>
</tbody>
</table>

<p>5 rows × 75 columns</p>
</div>
</div>
</div>
<section id="columns-list" class="level5">
<h5 class="anchored" data-anchor-id="columns-list">Columns List</h5>
<div id="d80f0aeb" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>datasets[<span class="st">"LA"</span>].columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Index(['id', 'listing_url', 'scrape_id', 'last_scraped', 'source', 'name',
       'description', 'neighborhood_overview', 'picture_url', 'host_id',
       'host_url', 'host_name', 'host_since', 'host_location', 'host_about',
       'host_response_time', 'host_response_rate', 'host_acceptance_rate',
       'host_is_superhost', 'host_thumbnail_url', 'host_picture_url',
       'host_neighbourhood', 'host_listings_count',
       'host_total_listings_count', 'host_verifications',
       'host_has_profile_pic', 'host_identity_verified', 'neighbourhood',
       'neighbourhood_cleansed', 'neighbourhood_group_cleansed', 'latitude',
       'longitude', 'property_type', 'room_type', 'accommodates', 'bathrooms',
       'bathrooms_text', 'bedrooms', 'beds', 'amenities', 'price',
       'minimum_nights', 'maximum_nights', 'minimum_minimum_nights',
       'maximum_minimum_nights', 'minimum_maximum_nights',
       'maximum_maximum_nights', 'minimum_nights_avg_ntm',
       'maximum_nights_avg_ntm', 'calendar_updated', 'has_availability',
       'availability_30', 'availability_60', 'availability_90',
       'availability_365', 'calendar_last_scraped', 'number_of_reviews',
       'number_of_reviews_ltm', 'number_of_reviews_l30d', 'first_review',
       'last_review', 'review_scores_rating', 'review_scores_accuracy',
       'review_scores_cleanliness', 'review_scores_checkin',
       'review_scores_communication', 'review_scores_location',
       'review_scores_value', 'license', 'instant_bookable',
       'calculated_host_listings_count',
       'calculated_host_listings_count_entire_homes',
       'calculated_host_listings_count_private_rooms',
       'calculated_host_listings_count_shared_rooms', 'reviews_per_month'],
      dtype='object')</code></pre>
</div>
</div>
</section>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<div id="eecf0273" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_airbnb_data(df):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    cols_to_drop <span class="op">=</span> [<span class="st">'source'</span>, <span class="st">'id'</span>, <span class="st">'host_id'</span>, <span class="st">'scrape_id'</span>, <span class="st">'last_scraped'</span>, <span class="st">'listing_url'</span>, <span class="st">'thumbnail_url'</span>, <span class="st">'medium_url'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'picture_url'</span>, <span class="st">'xl_picture_url'</span>, <span class="st">'host_url'</span>, <span class="st">'host_thumbnail_url'</span>, <span class="st">'host_picture_url'</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    df.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> cols_to_drop <span class="cf">if</span> col <span class="kw">in</span> df.columns], inplace<span class="op">=</span><span class="va">True</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'price'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'price'</span>] <span class="op">=</span> df[<span class="st">'price'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'price'</span>] <span class="op">=</span> df[<span class="st">'price'</span>].<span class="bu">str</span>.replace(<span class="vs">r'[\$,]'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'price'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'price'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    df.fillna({</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'price'</span>: df[<span class="st">'price'</span>].median() <span class="cf">if</span> <span class="st">'price'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> np.nan,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'review_scores_rating'</span>: df[<span class="st">'review_scores_rating'</span>].mean() <span class="cf">if</span> <span class="st">'review_scores_rating'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> np.nan,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bedrooms'</span>: df[<span class="st">'bedrooms'</span>].mode()[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">'bedrooms'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> np.nan,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bathrooms'</span>: df[<span class="st">'bathrooms'</span>].mode()[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">'bathrooms'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> np.nan,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    }, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    bool_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> df[col].dtype <span class="op">==</span> <span class="bu">object</span> <span class="kw">and</span> df[col].nunique() <span class="op">==</span> <span class="dv">2</span>]</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> bool_columns:</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col].<span class="bu">map</span>({<span class="st">'t'</span>: <span class="dv">1</span>, <span class="st">'f'</span>: <span class="dv">0</span>})</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    df.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>datasets_cleaned <span class="op">=</span> {name: clean_airbnb_data(df.copy()) <span class="cf">for</span> name, df <span class="kw">in</span> datasets.items()}</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>saved_paths <span class="op">=</span> {}</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, df <span class="kw">in</span> datasets_cleaned.items():</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="ss">f"cleaned_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.csv"</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    df.to_csv(path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    saved_paths[name] <span class="op">=</span> path</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>saved_paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>{'LA': 'cleaned_LA.csv',
 'Pdx': 'cleaned_Pdx.csv',
 'Salem': 'cleaned_Salem.csv',
 'Sea': 'cleaned_Sea.csv',
 'SD': 'cleaned_SD.csv',
 'SF': 'cleaned_SF.csv'}</code></pre>
</div>
</div>
</section>
<section id="data-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="data-preprocessing">Data preprocessing</h3>
<ol type="1">
<li>I have encoded categorical features</li>
</ol>
<div id="87caf7f4" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode_categorical(df):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    categorical_cols <span class="op">=</span> [<span class="st">'room_type'</span>, <span class="st">'neighbourhood'</span>, <span class="st">'property_type'</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.get_dummies(df, columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> categorical_cols <span class="cf">if</span> col <span class="kw">in</span> df.columns], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ordinal_cols <span class="op">=</span> [<span class="st">'host_is_superhost'</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> ordinal_cols:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].<span class="bu">map</span>({<span class="st">'t'</span>: <span class="dv">1</span>, <span class="st">'f'</span>: <span class="dv">0</span>})</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>datasets_encoded <span class="op">=</span> {name: encode_categorical(df.copy()) <span class="cf">for</span> name, df <span class="kw">in</span> datasets_cleaned.items()}</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>datasets_encoded[<span class="st">'LA'</span>].columns.tolist()[:<span class="dv">20</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>['name',
 'description',
 'neighborhood_overview',
 'host_name',
 'host_since',
 'host_location',
 'host_about',
 'host_response_time',
 'host_response_rate',
 'host_acceptance_rate',
 'host_is_superhost',
 'host_neighbourhood',
 'host_listings_count',
 'host_total_listings_count',
 'host_verifications',
 'host_has_profile_pic',
 'host_identity_verified',
 'neighbourhood_cleansed',
 'neighbourhood_group_cleansed',
 'latitude']</code></pre>
</div>
</div>
</section>
<section id="handling-outliers" class="level3">
<h3 class="anchored" data-anchor-id="handling-outliers">Handling Outliers</h3>
<p>Outliers are removed using Interquartile Range</p>
<div id="188af8f5" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_outliers_iqr(df, column):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    Q1 <span class="op">=</span> df[column].quantile(<span class="fl">0.25</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    Q3 <span class="op">=</span> df[column].quantile(<span class="fl">0.75</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> Q1 <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> Q3 <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df[(df[column] <span class="op">&gt;=</span> lower) <span class="op">&amp;</span> (df[column] <span class="op">&lt;=</span> upper)]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>columns_to_check <span class="op">=</span> [<span class="st">'price'</span>, <span class="st">'bedrooms'</span>, <span class="st">'bathrooms'</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>datasets_no_outliers <span class="op">=</span> {}</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, df <span class="kw">in</span> datasets_encoded.items():</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    df_cleaned <span class="op">=</span> df.copy()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> columns_to_check:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df_cleaned.columns:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            df_cleaned <span class="op">=</span> remove_outliers_iqr(df_cleaned, col)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    datasets_no_outliers[name] <span class="op">=</span> df_cleaned</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>outlier_summary <span class="op">=</span> pd.DataFrame({</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Dataset'</span>: datasets_encoded.keys(),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Before'</span>: [datasets_encoded[name].shape[<span class="dv">0</span>] <span class="cf">for</span> name <span class="kw">in</span> datasets_encoded],</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'After'</span>: [datasets_no_outliers[name].shape[<span class="dv">0</span>] <span class="cf">for</span> name <span class="kw">in</span> datasets_encoded]</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>outlier_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dataset</th>
<th data-quarto-table-cell-role="th">Before</th>
<th data-quarto-table-cell-role="th">After</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>LA</td>
<td>46601</td>
<td>30252</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Pdx</td>
<td>4514</td>
<td>3427</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Salem</td>
<td>354</td>
<td>234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Sea</td>
<td>6769</td>
<td>4538</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SD</td>
<td>12833</td>
<td>10750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>SF</td>
<td>7813</td>
<td>5823</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="exploratory-data-analysis-using-visualizations" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-using-visualizations">Exploratory Data Analysis using Visualizations</h3>
<div id="a54f8d3b" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cleaned_airbnb_data.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df.shape, df.columns</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\3811534416.py:1: DtypeWarning:

Columns (16,34,61,62,63,64,65,66,67,68,69,70,71,72,78,82,86,87,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,104,105,106,107,108,109,110,112,113,114,115,116,117,119,120,121,122,124,125,126,127,128,129,130,131,132,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,166,167,168,169,170,171) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">neighborhood_overview</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">host_location</th>
<th data-quarto-table-cell-role="th">host_about</th>
<th data-quarto-table-cell-role="th">host_response_time</th>
<th data-quarto-table-cell-role="th">host_response_rate</th>
<th data-quarto-table-cell-role="th">host_acceptance_rate</th>
<th data-quarto-table-cell-role="th">host_neighbourhood</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">property_type_Train</th>
<th data-quarto-table-cell-role="th">property_type_Treehouse</th>
<th data-quarto-table-cell-role="th">property_type_Yurt</th>
<th data-quarto-table-cell-role="th">city</th>
<th data-quarto-table-cell-role="th">property_type_Private room in bus</th>
<th data-quarto-table-cell-role="th">property_type_Private room in hut</th>
<th data-quarto-table-cell-role="th">property_type_Religious building</th>
<th data-quarto-table-cell-role="th">property_type_Entire bed and breakfast</th>
<th data-quarto-table-cell-role="th">property_type_Hotel room</th>
<th data-quarto-table-cell-role="th">property_type_Entire in-law</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Runyon Canyon | Beau Furn Mirror Mini-Suite Fi...</td>
<td>Run Runyon Canyon, Our Gym &amp; Sauna Open &lt;br /&gt;...</td>
<td>Walk and run to Runyon Canyon, it is open!&lt;br ...</td>
<td>Chas.</td>
<td>Los Angeles, CA</td>
<td>Professional and technical writer.\nLiterary C...</td>
<td>within an hour</td>
<td>1.0</td>
<td>1.00</td>
<td>Hollywood</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>Los Angeles</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Zen Life at the Beach</td>
<td>An oasis of tranquility awaits you.</td>
<td>This is the best part of Santa Monica. Quiet, ...</td>
<td>Louise-Diane</td>
<td>Santa Monica, CA</td>
<td>I have been teaching yoga and meditation for 3...</td>
<td>within an hour</td>
<td>1.0</td>
<td>0.67</td>
<td>Santa Monica</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>Los Angeles</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>* Beautiful Master Suite/Jacuzzi Tub/*</td>
<td>Centrally located.... Furnished with King Size...</td>
<td>What makes the neighborhood unique is that the...</td>
<td>Bernadine</td>
<td>Bellflower, CA</td>
<td>Fair, open, honest and very informative for ne...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Bellflower</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>Los Angeles</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Poolside Serenity Studio</td>
<td>Our distinctive bachelor's studio for 1-3 gues...</td>
<td>NaN</td>
<td>Sarah</td>
<td>California, United States</td>
<td>My name is Sarah working in relocation propert...</td>
<td>within an hour</td>
<td>1.0</td>
<td>0.76</td>
<td>Woodland Hills/Warner Center</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>Los Angeles</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RUN Runyon, Beau Furn Rms w/ Stunning Terrace ...</td>
<td>Run Runyon Canyon and Views&lt;br /&gt;&lt;br /&gt;Gym &amp; S...</td>
<td>We are in the middle of one of the great citie...</td>
<td>Chas.</td>
<td>Los Angeles, CA</td>
<td>Professional and technical writer.\nLiterary C...</td>
<td>within an hour</td>
<td>1.0</td>
<td>1.00</td>
<td>Hollywood</td>
<td>...</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>Los Angeles</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 172 columns</p>
</div>
</div>
</div>
<p><strong>Visualization 1: Price Distribution for overall dataset(All cities)</strong></p>
<p>The histogram shows the overall distribution of Airbnb listing prices across all cities. Most listings are concentrated below $500, with a sharp right-skew indicating a long tail of higher-priced properties. To reduce distortion from extreme values, the x-axis is capped at $1000. This reveals that the majority of listings fall within a moderate price range, making it more interpretable.</p>
<div id="9263dff5" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'price'</span>], bins<span class="op">=</span><span class="dv">100</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="dv">1000</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Price Distribution (Capped at $1000)"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-9-output-1.png" width="701" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Visualization 2: City Based visualization for Prize Distribution</strong></p>
<p>The boxplot compares the price distributions across individual cities. San Francisco and Los Angeles exhibit higher median prices and wider interquartile ranges, indicating more variability and a higher overall cost of listings. In contrast, cities like Salem and Portland show tighter distributions and lower medians, reflecting more budget-friendly markets. Outliers are present in all cities, especially in high-demand urban areas, and should be handled carefully during modeling.</p>
<div id="006151e3" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"city"</span>, y<span class="op">=</span><span class="st">"price"</span>, palette<span class="op">=</span><span class="st">"Set2"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Airbnb Price Distribution by City (Boxplot)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"City"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Price ($)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>sns.despine()  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\3583602026.py:3: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-10-output-2.png" width="1143" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Visualization 3: Comparison of Price vs Accomodates</strong></p>
<p>This boxplot explores how listing prices vary with the number of guests a property can accommodate, focusing on listings that host up to 10 guests.</p>
<p>We observe a clear upward trend in median price as the number of accommodated guests increases. Listings that can host more people typically charge higher prices, which aligns with expectations — larger properties often offer more space, amenities, or multiple rooms.</p>
<div id="078d5ffc" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'accommodates'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'price'</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df[df[<span class="st">'accommodates'</span>] <span class="op">&lt;=</span> <span class="dv">10</span>],</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"husl"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">' Price vs Number of Guests Accommodated'</span>, fontsize<span class="op">=</span><span class="dv">15</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Accommodates'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Price ($)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\3436896097.py:3: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-11-output-2.png" width="951" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Visualization 4: Review Score vs Price for overall city(Higher the reviews scores, higher the rentals)</strong></p>
<p>This scatter plot examines the relationship between listing price and review scores across all cities.</p>
<p>We observe that most listings cluster between review scores of 80 and 100, with prices primarily concentrated below $500. While higher review scores may suggest better listing quality, there is no strong linear relationship between review scores and price. High-priced listings exist across all score ranges, and high review scores are not exclusive to expensive listings.</p>
<div id="f920104d" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'review_scores_rating'</span>, y<span class="op">=</span><span class="st">'price'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Review Score Rating vs Price'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Review Score'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Price ($)'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-12-output-1.png" width="758" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Visualization 5: review score rating vs Price by city</strong></p>
<p>Across most cities, we observe a dense cluster of listings with high review scores (above 85) and moderate prices (under $300). This indicates that a good guest experience does not necessarily correlate with high listing prices. In cities like San Francisco and Los Angeles, we see a broader spread of prices — especially in the higher range — even for similarly rated listings. This reflects the impact of local market dynamics and demand.</p>
<p>Overall, the pattern reinforces that while high review scores are important for guest satisfaction, they are not the sole determinant of listing price. City-specific factors play a major role in shaping the pricing landscape.</p>
<div id="11cbc64d" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df[[<span class="st">'city'</span>, <span class="st">'price'</span>, <span class="st">'review_scores_rating'</span>]].dropna()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df2[df2[<span class="st">'price'</span>].between(<span class="dv">10</span>, <span class="dv">1000</span>)]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot: Review Scores vs Price, Faceted by City</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df2, col<span class="op">=</span><span class="st">"city"</span>, col_wrap<span class="op">=</span><span class="dv">3</span>, height<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(sns.scatterplot, <span class="st">"review_scores_rating"</span>, <span class="st">"price"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"Review Score"</span>, <span class="st">"Price ($)"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>g.fig.subplots_adjust(top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>g.fig.suptitle(<span class="st">"Review Score Rating vs Price by City"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-13-output-1.png" width="1142" height="757" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Visualization 6: Minimum Nights spent</strong></p>
<p>This boxplot highlights the distribution of the minimum_nights variable across all listings.</p>
<p>We can clearly see the presence of extreme outliers on the right side, with some listings requiring unusually long minimum stays. While the majority of listings have a minimum night requirement below 30 days, a small number have values that stretch well beyond typical short-term rental expectations (e.g., 100+ nights), likely skewing the distribution.</p>
<p><strong>Overall Findings:</strong></p>
<p>Most Airbnb listings across all cities have a reasonable minimum night stay — typically between 1 and 7 nights — aligning with short-term rental behavior. However, a small number of listings set extremely high minimum night thresholds (e.g., 60+, even 365), which are clear outliers and likely reflect special cases such as long-term rentals or misconfigured listings.</p>
<p>These outliers can distort the distribution and influence model performance, so applying caps (e.g., filtering out listings with minimum_nights &gt; 30) is necessary to maintain modeling accuracy and data quality.</p>
</section>
<section id="preparing-engineered-data-for-models" class="level3">
<h3 class="anchored" data-anchor-id="preparing-engineered-data-for-models">Preparing Engineered data for Models</h3>
<p>Columns (mostly numerical required for regression models to predict price)</p>
<p>This cleaned and feature-engineered dataset significantly improves model readiness by:</p>
<p>Removing noisy or skewed data points</p>
<p>Capturing meaningful business logic (e.g., shared vs.&nbsp;private rooms)</p>
<p>Creating derived features that may improve prediction power</p>
<div id="c547fab1" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>columns_to_keep <span class="op">=</span> [</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'price'</span>, <span class="st">'accommodates'</span>, <span class="st">'minimum_nights'</span>, <span class="st">'maximum_nights'</span>, <span class="st">'bedrooms'</span>, <span class="st">'beds'</span>, <span class="st">'bathrooms_text'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'number_of_reviews'</span>, <span class="st">'reviews_per_month'</span>, <span class="st">'availability_30'</span>, <span class="st">'availability_60'</span>,<span class="st">'availability_90'</span>, <span class="st">'availability_365'</span> ,<span class="st">'review_scores_rating'</span>, <span class="st">'instant_bookable'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'room_type_Private room'</span>, <span class="st">'room_type_Hotel room'</span>, <span class="st">'city'</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df[columns_to_keep].copy()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>df1.dropna(subset<span class="op">=</span>[<span class="st">'price'</span>, <span class="st">'accommodates'</span>, <span class="st">'bedrooms'</span>,  <span class="st">'review_scores_rating'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df1[df1[<span class="st">'price'</span>].between(<span class="dv">10</span>, <span class="dv">1000</span>)]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df1[df1[<span class="st">'minimum_nights'</span>] <span class="op">&lt;=</span> <span class="dv">365</span>]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df1[df1[<span class="st">'bedrooms'</span>] <span class="op">&lt;=</span> <span class="dv">10</span>]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'bathrooms'</span>] <span class="op">=</span> df1[<span class="st">'bathrooms_text'</span>].<span class="bu">str</span>.extract(<span class="vs">r'([\d\.]+)'</span>).astype(<span class="bu">float</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>df1.drop(columns<span class="op">=</span>[<span class="st">'bathrooms_text'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'log_price'</span>] <span class="op">=</span> np.log1p(df1[<span class="st">'price'</span>])</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'reviews_total'</span>] <span class="op">=</span> df1[<span class="st">'number_of_reviews'</span>] <span class="op">*</span> df1[<span class="st">'reviews_per_month'</span>]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'price_per_person'</span>] <span class="op">=</span> df1[<span class="st">'price'</span>] <span class="op">/</span> df1[<span class="st">'accommodates'</span>]</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>df1.replace([np.inf, <span class="op">-</span>np.inf], np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">'is_shared'</span>] <span class="op">=</span> (df1[<span class="st">'room_type_Private room'</span>] <span class="op">|</span> df1[<span class="st">'room_type_Hotel room'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.get_dummies(df1, columns<span class="op">=</span>[<span class="st">'city'</span>], drop_first<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>df1.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">bedrooms</th>
<th data-quarto-table-cell-role="th">beds</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
<th data-quarto-table-cell-role="th">availability_30</th>
<th data-quarto-table-cell-role="th">availability_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">log_price</th>
<th data-quarto-table-cell-role="th">reviews_total</th>
<th data-quarto-table-cell-role="th">price_per_person</th>
<th data-quarto-table-cell-role="th">is_shared</th>
<th data-quarto-table-cell-role="th">city_Los Angeles</th>
<th data-quarto-table-cell-role="th">city_Portland</th>
<th data-quarto-table-cell-role="th">city_Salem</th>
<th data-quarto-table-cell-role="th">city_San Diego</th>
<th data-quarto-table-cell-role="th">city_San Francisco</th>
<th data-quarto-table-cell-role="th">city_Seattle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>87</td>
<td>1</td>
<td>30</td>
<td>550</td>
<td>1</td>
<td>1.0</td>
<td>44</td>
<td>0.34</td>
<td>30</td>
<td>60</td>
<td>...</td>
<td>4.477337</td>
<td>14.96</td>
<td>87.000000</td>
<td>1</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>139</td>
<td>1</td>
<td>7</td>
<td>27</td>
<td>1</td>
<td>1.0</td>
<td>24</td>
<td>0.15</td>
<td>21</td>
<td>32</td>
<td>...</td>
<td>4.941642</td>
<td>3.60</td>
<td>139.000000</td>
<td>1</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>92</td>
<td>1</td>
<td>30</td>
<td>500</td>
<td>1</td>
<td>1.0</td>
<td>34</td>
<td>0.18</td>
<td>18</td>
<td>48</td>
<td>...</td>
<td>4.532599</td>
<td>6.12</td>
<td>92.000000</td>
<td>1</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>100</td>
<td>3</td>
<td>31</td>
<td>1125</td>
<td>1</td>
<td>2.0</td>
<td>293</td>
<td>1.84</td>
<td>3</td>
<td>15</td>
<td>...</td>
<td>4.615121</td>
<td>539.12</td>
<td>33.333333</td>
<td>0</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>100</td>
<td>2</td>
<td>30</td>
<td>120</td>
<td>1</td>
<td>1.0</td>
<td>240</td>
<td>1.28</td>
<td>29</td>
<td>59</td>
<td>...</td>
<td>4.615121</td>
<td>307.20</td>
<td>50.000000</td>
<td>1</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55004</td>
<td>259</td>
<td>8</td>
<td>1</td>
<td>365</td>
<td>3</td>
<td>4.0</td>
<td>2</td>
<td>2.00</td>
<td>8</td>
<td>25</td>
<td>...</td>
<td>5.560682</td>
<td>4.00</td>
<td>32.375000</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55007</td>
<td>132</td>
<td>2</td>
<td>2</td>
<td>30</td>
<td>1</td>
<td>1.0</td>
<td>3</td>
<td>3.00</td>
<td>22</td>
<td>34</td>
<td>...</td>
<td>4.890349</td>
<td>9.00</td>
<td>66.000000</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55009</td>
<td>185</td>
<td>5</td>
<td>1</td>
<td>29</td>
<td>2</td>
<td>3.0</td>
<td>1</td>
<td>1.00</td>
<td>17</td>
<td>40</td>
<td>...</td>
<td>5.225747</td>
<td>1.00</td>
<td>37.000000</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55012</td>
<td>172</td>
<td>3</td>
<td>1</td>
<td>1125</td>
<td>1</td>
<td>1.0</td>
<td>2</td>
<td>2.00</td>
<td>24</td>
<td>43</td>
<td>...</td>
<td>5.153292</td>
<td>4.00</td>
<td>57.333333</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55019</td>
<td>113</td>
<td>2</td>
<td>1</td>
<td>365</td>
<td>1</td>
<td>2.0</td>
<td>1</td>
<td>1.00</td>
<td>29</td>
<td>57</td>
<td>...</td>
<td>4.736198</td>
<td>1.00</td>
<td>56.500000</td>
<td>0</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>34843 rows × 27 columns</p>
</div>
</div>
</div>
<p><strong>Correlation</strong> Finding the correlation between the features</p>
<div id="88474714" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>X_corr <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>X_corr <span class="op">=</span> X_corr.loc[:, <span class="op">~</span>X_corr.columns.<span class="bu">str</span>.startswith(<span class="st">"city_"</span>)]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> X_corr.corr()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, fmt<span class="op">=</span><span class="st">".2f"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">" Correlation Between Features (Excluding City Dummies)"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-15-output-1.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Correlation for Individual cities</strong></p>
<div id="930d4b50" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify city columns</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>city_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df1.columns <span class="cf">if</span> col.startswith(<span class="st">"city_"</span>)]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city_col <span class="kw">in</span> city_cols:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    df_city <span class="op">=</span> df1[df1[city_col] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_city) <span class="op">&lt;</span> <span class="dv">100</span>:  <span class="co"># optional filter to skip small samples</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"⏭️ Skipping </span><span class="sc">{</span>city_col<span class="sc">.</span>replace(<span class="st">'city_'</span>, <span class="st">''</span>)<span class="sc">}</span><span class="ss"> (too few rows)"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop city columns</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    df_city_cleaned <span class="op">=</span> df_city.drop(columns<span class="op">=</span>[col <span class="cf">for</span> col <span class="kw">in</span> df_city.columns <span class="cf">if</span> col.startswith(<span class="st">"city_"</span>) <span class="kw">or</span> col <span class="kw">in</span> [<span class="st">'price'</span>, <span class="st">'log_price'</span>]])</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute correlation</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="op">=</span> df_city_cleaned.corr()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, fmt<span class="op">=</span><span class="st">".2f"</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"🔍 Feature Correlation - </span><span class="sc">{</span>city_col<span class="sc">.</span>replace(<span class="st">'city_'</span>, <span class="st">''</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-2.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-4.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-6.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-8.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-10.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\1800663183.py:21: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.

C:\Users\riyap\anaconda3\envs\airbnb-safe\lib\site-packages\IPython\core\pylabtools.py:170: UserWarning:

Glyph 128269 (\N{LEFT-POINTING MAGNIFYING GLASS}) missing from font(s) DejaVu Sans.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-16-output-12.png" width="1067" height="757" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>From this, we can infer that bedrooms, reviews are highly correlated with other features. However, the strength and nature of these relationships vary across cities, suggesting that a one-size-fits-all pricing model may not be optimal. Understanding city-specific correlations is key to building more accurate, localized predictive models.</p>
<section id="datatypes" class="level5">
<h5 class="anchored" data-anchor-id="datatypes">Datatypes</h5>
<div id="77a55d95" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df1.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>price                       int64
accommodates                int64
minimum_nights              int64
maximum_nights              int64
bedrooms                    int64
beds                      float64
number_of_reviews           int64
reviews_per_month         float64
availability_30             int64
availability_60             int64
availability_90             int64
availability_365            int64
review_scores_rating      float64
instant_bookable            int64
room_type_Private room       bool
room_type_Hotel room         bool
bathrooms                 float64
log_price                 float64
reviews_total             float64
price_per_person          float64
is_shared                   int64
city_Los Angeles             bool
city_Portland                bool
city_Salem                   bool
city_San Diego               bool
city_San Francisco           bool
city_Seattle                 bool
dtype: object</code></pre>
</div>
</div>
</section>
</section>
<section id="machine-learning-models" class="level3">
<h3 class="anchored" data-anchor-id="machine-learning-models">Machine Learning Models</h3>
<section id="ols-model" class="level4">
<h4 class="anchored" data-anchor-id="ols-model">OLS Model</h4>
<div id="1df8e58d" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.loc[:, X.dtypes <span class="op">!=</span> <span class="st">"bool"</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X.dropna()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">"log_price"</span>].loc[X.index]</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>X_const <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X_const).fit()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:              log_price   R-squared:                       0.846
Model:                            OLS   Adj. R-squared:                  0.846
Method:                 Least Squares   F-statistic:                 1.126e+04
Date:                Sat, 22 Mar 2025   Prob (F-statistic):               0.00
Time:                        00:51:41   Log-Likelihood:                 4816.4
No. Observations:               34843   AIC:                            -9597.
Df Residuals:                   34825   BIC:                            -9445.
Df Model:                          17                                         
Covariance Type:            nonrobust                                         
========================================================================================
                           coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------
const                    3.2560      0.016    199.877      0.000       3.224       3.288
accommodates             0.2308      0.001    172.619      0.000       0.228       0.233
minimum_nights          -0.0014   6.81e-05    -21.231      0.000      -0.002      -0.001
maximum_nights        1.455e-07    2.1e-07      0.692      0.489   -2.67e-07    5.58e-07
bedrooms                 0.0300      0.002     12.879      0.000       0.025       0.035
beds                    -0.0289      0.002    -16.282      0.000      -0.032      -0.025
number_of_reviews     2.203e-05   1.25e-05      1.758      0.079   -2.53e-06    4.66e-05
reviews_per_month       -0.0011      0.001     -1.373      0.170      -0.003       0.000
availability_30          0.0022      0.000      8.535      0.000       0.002       0.003
availability_60         -0.0009      0.000     -3.187      0.001      -0.002      -0.000
availability_90      -9.928e-05      0.000     -0.633      0.527      -0.000       0.000
availability_365      1.882e-05   1.11e-05      1.691      0.091      -3e-06    4.06e-05
review_scores_rating     0.0337      0.003     10.633      0.000       0.028       0.040
instant_bookable         0.0208      0.003      8.057      0.000       0.016       0.026
bathrooms                0.0266      0.004      5.982      0.000       0.018       0.035
reviews_total        -2.277e-06   1.17e-06     -1.948      0.051   -4.57e-06    1.46e-08
price_per_person         0.0144    4.8e-05    301.048      0.000       0.014       0.015
is_shared               -0.2263      0.003    -74.541      0.000      -0.232      -0.220
==============================================================================
Omnibus:                    21161.124   Durbin-Watson:                   1.869
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           846559.663
Skew:                          -2.321   Prob(JB):                         0.00
Kurtosis:                      26.697   Cond. No.                     7.91e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 7.91e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p><strong>Summary of P Values</strong></p>
<div id="006b208d" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> model.summary2().tables[<span class="dv">1</span>][[<span class="st">'Coef.'</span>, <span class="st">'P&gt;|t|'</span>]]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_df.sort_values(<span class="st">"P&gt;|t|"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             Coef.         P&gt;|t|
const                 3.256024e+00  0.000000e+00
accommodates          2.308184e-01  0.000000e+00
is_shared            -2.262728e-01  0.000000e+00
price_per_person      1.443962e-02  0.000000e+00
minimum_nights       -1.445258e-03  2.091391e-99
beds                 -2.888701e-02  2.188175e-59
bedrooms              2.996567e-02  7.206408e-38
review_scores_rating  3.372124e-02  2.302537e-26
availability_30       2.218688e-03  1.461353e-17
instant_bookable      2.079859e-02  8.052925e-16
bathrooms             2.664614e-02  2.221042e-09
availability_60      -9.329862e-04  1.437878e-03
reviews_total        -2.276758e-06  5.147347e-02
number_of_reviews     2.202931e-05  7.872465e-02
availability_365      1.882401e-05  9.085486e-02
reviews_per_month    -1.092164e-03  1.698733e-01
maximum_nights        1.455256e-07  4.891104e-01
availability_90      -9.928428e-05  5.266982e-01</code></pre>
</div>
</div>
<p><strong>Inference:</strong></p>
<p>Highly Significant Predictors (p &lt; 0.05):</p>
<p>1)accommodates, bedrooms, and availability_30 are typically strong predictors of price</p>
<p>2)price_per_person and review_scores_rating often show significance depending on the data</p>
</section>
<section id="regression-model-price-prediction" class="level4">
<h4 class="anchored" data-anchor-id="regression-model-price-prediction">Regression Model (Price Prediction)</h4>
<div id="78f6d0de" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">"log_price"</span>]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> StandardScaler().fit_transform(X)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LinearRegression()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>y_pred_lr <span class="op">=</span> lr.predict(X_test)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> LassoCV(cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>lasso.fit(X_train, y_train)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>y_pred_lasso <span class="op">=</span> lasso.predict(X_test)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> RidgeCV(cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>ridge.fit(X_train, y_train)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>y_pred_ridge <span class="op">=</span> ridge.predict(X_test)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>results_all <span class="op">=</span> pd.DataFrame({</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Model"</span>: [<span class="st">"Linear Regression"</span>, <span class="st">"Lasso Regression"</span>, <span class="st">"Ridge Regression"</span>],</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R² Score"</span>: [</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        r2_score(y_test, y_pred_lr),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        r2_score(y_test, y_pred_lasso),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        r2_score(y_test, y_pred_ridge)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RMSE"</span>: [</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        mean_squared_error(y_test, y_pred_lr),</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        mean_squared_error(y_test, y_pred_lasso),</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        mean_squared_error(y_test, y_pred_ridge)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>lasso_selected_features <span class="op">=</span> pd.Series(lasso.coef_, index<span class="op">=</span>X.columns)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>lasso_selected_features <span class="op">=</span> lasso_selected_features[lasso_selected_features <span class="op">!=</span> <span class="dv">0</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Model Performance (All Cities Combined)"</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results_all.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Accuracy of each model (R² score as %):"</span>)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> results_all.iterrows():</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'Model'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[<span class="st">'R² Score'</span>] <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Top Lasso-Selected Features (Non-zero coefficients):"</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lasso_selected_features.head(<span class="dv">15</span>).to_string())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Model Performance (All Cities Combined)
            Model  R² Score     RMSE
Linear Regression  0.855777 0.042743
 Lasso Regression  0.857758 0.042156
 Ridge Regression  0.856056 0.042660

 Accuracy of each model (R² score as %):
Linear Regression: 85.58%
Lasso Regression: 85.78%
Ridge Regression: 85.61%

 Top Lasso-Selected Features (Non-zero coefficients):
accommodates            0.383779
price_per_person        0.370798
bedrooms                0.022030
city_San Diego          0.018758
city_San Francisco      0.015839
review_scores_rating    0.013137
availability_30         0.011928
instant_bookable        0.007048
availability_365        0.002342
bathrooms               0.001619
number_of_reviews       0.000846
availability_60        -0.000069
reviews_total          -0.002600
city_Salem             -0.003981
availability_90        -0.009535</code></pre>
</div>
</div>
<p>Inference: Lasso regression seems to have performed better than the other two!</p>
<section id="for-individual-cities" class="level5">
<h5 class="anchored" data-anchor-id="for-individual-cities">For Individual cities</h5>
<div id="0afcc0a1" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>city_results <span class="op">=</span> []</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>unique_cities <span class="op">=</span> df1.columns[df1.columns.<span class="bu">str</span>.startswith(<span class="st">"city_"</span>)]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city_col <span class="kw">in</span> unique_cities:</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    df_city <span class="op">=</span> df1[df1[city_col] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_city) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    X_city <span class="op">=</span> df_city.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>] <span class="op">+</span> <span class="bu">list</span>(unique_cities))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    y_city <span class="op">=</span> df_city[<span class="st">"log_price"</span>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    X_scaled <span class="op">=</span> StandardScaler().fit_transform(X_city)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y_city, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    lr <span class="op">=</span> LinearRegression().fit(X_train, y_train)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    lasso <span class="op">=</span> LassoCV(cv<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>).fit(X_train, y_train)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    ridge <span class="op">=</span> RidgeCV(cv<span class="op">=</span><span class="dv">5</span>).fit(X_train, y_train)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    y_pred_lr <span class="op">=</span> lr.predict(X_test)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    y_pred_lasso <span class="op">=</span> lasso.predict(X_test)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    y_pred_ridge <span class="op">=</span> ridge.predict(X_test)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    city_results.append({</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"City"</span>: city_col.replace(<span class="st">"city_"</span>, <span class="st">""</span>),</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>: <span class="st">"Linear"</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R²"</span>: r2_score(y_test, y_pred_lr),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RMSE"</span>: mean_squared_error(y_test, y_pred_lr)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    city_results.append({</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"City"</span>: city_col.replace(<span class="st">"city_"</span>, <span class="st">""</span>),</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>: <span class="st">"Lasso"</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R²"</span>: r2_score(y_test, y_pred_lasso),</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RMSE"</span>: mean_squared_error(y_test, y_pred_lasso)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    city_results.append({</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"City"</span>: city_col.replace(<span class="st">"city_"</span>, <span class="st">""</span>),</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>: <span class="st">"Ridge"</span>,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R²"</span>: r2_score(y_test, y_pred_ridge),</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RMSE"</span>: mean_squared_error(y_test, y_pred_ridge)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame(city_results)</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>pivot_table <span class="op">=</span> results_df.pivot(index<span class="op">=</span><span class="st">"City"</span>, columns<span class="op">=</span><span class="st">"Model"</span>, values<span class="op">=</span>[<span class="st">"R²"</span>, <span class="st">"RMSE"</span>])</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Per-City Model Performance (R² and RMSE):</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>display(pivot_table.<span class="bu">round</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Per-City Model Performance (R² and RMSE):
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">R²</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">RMSE</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">Lasso</th>
<th data-quarto-table-cell-role="th">Linear</th>
<th data-quarto-table-cell-role="th">Ridge</th>
<th data-quarto-table-cell-role="th">Lasso</th>
<th data-quarto-table-cell-role="th">Linear</th>
<th data-quarto-table-cell-role="th">Ridge</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Los Angeles</td>
<td>0.811</td>
<td>0.811</td>
<td>0.811</td>
<td>0.045</td>
<td>0.045</td>
<td>0.045</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Portland</td>
<td>0.869</td>
<td>0.869</td>
<td>0.868</td>
<td>0.017</td>
<td>0.017</td>
<td>0.017</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Salem</td>
<td>0.870</td>
<td>0.880</td>
<td>0.880</td>
<td>0.023</td>
<td>0.021</td>
<td>0.021</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">San Diego</td>
<td>0.887</td>
<td>0.887</td>
<td>0.887</td>
<td>0.042</td>
<td>0.042</td>
<td>0.042</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">San Francisco</td>
<td>0.842</td>
<td>0.842</td>
<td>0.842</td>
<td>0.038</td>
<td>0.038</td>
<td>0.038</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Seattle</td>
<td>0.849</td>
<td>0.849</td>
<td>0.849</td>
<td>0.024</td>
<td>0.024</td>
<td>0.024</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Inference: These models cannot capture non-linear pattern #### KNN (Non Linearity)</p>
<div id="1bd24cbc" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>knn.fit(X_train, y_train)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> knn.predict(X_test)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"k-NN Regressor Performance:"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R² Score: </span><span class="sc">{</span>r2<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>rmse<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>k-NN Regressor Performance:
R² Score: 0.656
RMSE: 0.06</code></pre>
</div>
</div>
<div id="ccac9f40" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>knn_city_results <span class="op">=</span> []</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>city_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df1.columns <span class="cf">if</span> col.startswith(<span class="st">"city_"</span>)]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city_col <span class="kw">in</span> city_cols:</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    df_city <span class="op">=</span> df1[df1[city_col] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_city) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f" Skipping </span><span class="sc">{</span>city_col<span class="sc">.</span>replace(<span class="st">'city_'</span>, <span class="st">''</span>)<span class="sc">}</span><span class="ss"> (&lt;200 listings)"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    X_city <span class="op">=</span> df_city.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>] <span class="op">+</span> city_cols)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    y_city <span class="op">=</span> df_city[<span class="st">"price"</span>]</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    X_scaled <span class="op">=</span> scaler.fit_transform(X_city)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y_city, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>,  shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_train, y_train)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> knn.predict(X_test)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    knn_city_results.append({</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"City"</span>: city_col.replace(<span class="st">"city_"</span>, <span class="st">""</span>),</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Model"</span>: <span class="st">"k-NN"</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R²"</span>: <span class="bu">round</span>(r2, <span class="dv">3</span>),</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RMSE"</span>: <span class="bu">round</span>(rmse, <span class="dv">2</span>)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>knn_results_df <span class="op">=</span> pd.DataFrame(knn_city_results).sort_values(<span class="st">"R²"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Per-City k-NN Model Performance:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(knn_results_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Per-City k-NN Model Performance:

         City Model    R²    RMSE
    San Diego  k-NN 0.831 2655.02
  Los Angeles  k-NN 0.719 1044.28
San Francisco  k-NN 0.710 1357.66
     Portland  k-NN 0.650  458.16
      Seattle  k-NN 0.635  843.33
        Salem  k-NN 0.569  583.07</code></pre>
</div>
</div>
<p><strong>Inference:</strong> Less data performs poorly when non-linear models are used. In this case, Salem has very less data.</p>
</section>
<section id="visualization-of-knn-all-data" class="level5">
<h5 class="anchored" data-anchor-id="visualization-of-knn-all-data">Visualization of KNN (all data)</h5>
<div id="a6153243" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>y_test, y<span class="op">=</span>y_pred, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>plt.plot([y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], [y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Predicted vs Actual Prices (Manual k-NN, k=4)"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Actual Price"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Price"</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-24-output-1.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Inference: k-NN performance is sensitive to data density. Sparse datasets and high-dimensional spaces can degrade its effectiveness — highlighting the need for larger samples or dimensionality reduction in smaller cities.</p>
</section>
</section>
<section id="random-forest-regressor" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-regressor">Random Forest Regressor</h4>
<div id="687a5b67" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>])</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">"price"</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    max_features<span class="op">=</span><span class="st">'sqrt'</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf.predict(X_test)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>r2_rf <span class="op">=</span> r2_score(y_test, y_pred_rf)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>rmse_rf <span class="op">=</span> mean_squared_error(y_test, y_pred_rf)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Random Forest Performance (Regularized)"</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R² Score: </span><span class="sc">{</span>r2_rf<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>rmse_rf<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Random Forest Performance (Regularized)
R² Score: 0.900
RMSE: 772.08</code></pre>
</div>
</div>
<p>Inference: Surprisingly, random forest regressor has better performance! Visualization:</p>
<div id="17c99f80" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>y_test, y<span class="op">=</span>y_pred_rf, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plt.plot([y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], [y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], <span class="st">'r--'</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Random Forest: Predicted vs Actual Price"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Actual Price"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Price"</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-26-output-1.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Extracting Features:</p>
<div id="a27826e7" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="op">=</span> pd.Series(rf.feature_importances_, index<span class="op">=</span>X.columns).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Top 10 Features:"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(feature_importance.head(<span class="dv">10</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>feature_importance.head(<span class="dv">10</span>), y<span class="op">=</span>feature_importance.head(<span class="dv">10</span>).index)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Top 10 Feature Importances - Random Forest"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Importance"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Feature"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Top 10 Features:
price_per_person          0.322465
bathrooms                 0.160631
accommodates              0.139974
bedrooms                  0.114759
beds                      0.066285
city_San Diego            0.041851
is_shared                 0.031957
room_type_Private room    0.031066
minimum_nights            0.017305
city_Portland             0.009128
dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-27-output-2.png" width="949" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Choosing Best Parameters</p>
<div id="3862c63d" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df1.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df1[<span class="st">"price"</span>]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max_depth"</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>],</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"min_samples_leaf"</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max_features"</span>: [<span class="st">"sqrt"</span>, <span class="st">"log2"</span>]</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(rf, param_grid, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">"neg_root_mean_squared_error"</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>best_rf <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" Best Parameters:"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_search.best_params_)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>y_pred_best_rf <span class="op">=</span> best_rf.predict(X_test)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>r2_best <span class="op">=</span> r2_score(y_test, y_pred_best_rf)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>rmse_best <span class="op">=</span> mean_squared_error(y_test, y_pred_best_rf)</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Tuned Random Forest Performance"</span>)</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R² Score: </span><span class="sc">{</span>r2_best<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"RMSE: </span><span class="sc">{</span>rmse_best<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Best Parameters:
{'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}

 Tuned Random Forest Performance
R² Score: 0.936
RMSE: 493.52</code></pre>
</div>
</div>
<p>Doing it for individual cities:</p>
<div id="63c2c992" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max_depth"</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>],</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"min_samples_leaf"</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max_features"</span>: [<span class="st">"sqrt"</span>, <span class="st">"log2"</span>]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>rf_city_results <span class="op">=</span> []</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>city_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df1.columns <span class="cf">if</span> col.startswith(<span class="st">"city_"</span>)]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> city_col <span class="kw">in</span> city_cols:</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    df_city <span class="op">=</span> df1[df1[city_col] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_city) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f" Skipping </span><span class="sc">{</span>city_col<span class="sc">.</span>replace(<span class="st">'city_'</span>, <span class="st">''</span>)<span class="sc">}</span><span class="ss"> (&lt;100 rows)"</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    X_city <span class="op">=</span> df_city.drop(columns<span class="op">=</span>[<span class="st">"price"</span>, <span class="st">"log_price"</span>] <span class="op">+</span> city_cols)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    y_city <span class="op">=</span> df_city[<span class="st">"price"</span>]</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    X_scaled <span class="op">=</span> scaler.fit_transform(X_city)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_scaled, y_city, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GridSearchCV</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    grid_search <span class="op">=</span> GridSearchCV(rf, param_grid, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">"neg_root_mean_squared_error"</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    grid_search.fit(X_train, y_train)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Best model</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    best_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> best_model.predict(X_test)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evaluate</span></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> r2_score(y_test, y_pred)</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> mean_squared_error(y_test, y_pred)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>    rf_city_results.append({</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"City"</span>: city_col.replace(<span class="st">"city_"</span>, <span class="st">""</span>),</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R²"</span>: <span class="bu">round</span>(r2, <span class="dv">3</span>),</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"RMSE"</span>: <span class="bu">round</span>(rmse, <span class="dv">2</span>),</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Best Params"</span>: grid_search.best_params_</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Display final results</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>rf_results_df <span class="op">=</span> pd.DataFrame(rf_city_results).sort_values(<span class="st">"R²"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"> Per-City Tuned Random Forest Results:"</span>)</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rf_results_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Per-City Tuned Random Forest Results:
         City    R²   RMSE                                                      Best Params
    San Diego 0.938 975.33 {'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}
  Los Angeles 0.922 288.68 {'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}
San Francisco 0.867 620.73 {'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}
      Seattle 0.844 360.52 {'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}
     Portland 0.827 226.16 {'max_depth': 15, 'max_features': 'sqrt', 'min_samples_leaf': 3}
        Salem 0.661 458.88 {'max_depth': 10, 'max_features': 'sqrt', 'min_samples_leaf': 3}</code></pre>
</div>
</div>
<p><strong>Inference:</strong> Random Forest is the best-performing model in this study, offering a strong balance between accuracy and interpretability. With city-specific tuning, it adapts well to varying market conditions and listing characteristics, making it an ideal choice for price prediction in heterogeneous, real-world datasets like Airbnb.</p>
</section>
<section id="k-means-clustering" class="level4">
<h4 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h4>
<p>Clustering the listings based on amenities! I used K-Means clustering to group Airbnb listings based on amenity richness and location features. The aim was to uncover distinct segments of listings that might reflect different pricing tiers Let’s see the distrubution of amenities per listing before that.</p>
<div id="15c82423" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'amenities_count'</span>] <span class="op">=</span> df[<span class="st">'amenities'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(<span class="bu">str</span>(x).split(<span class="st">','</span>)))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'amenities_count'</span>]]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'amenities_count'</span>], bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Amenities per Listing"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Amenities Count"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Number of Listings"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-30-output-1.png" width="601" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="elbow-method-to-find-k" class="level4">
<h4 class="anchored" data-anchor-id="elbow-method-to-find-k">Elbow Method to find K:</h4>
<div id="55cb9875" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Elbow Method</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>inertia <span class="op">=</span> []</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K:</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    kmeans.fit(X_scaled)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    inertia.append(kmeans.inertia_)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>plt.plot(K, inertia, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Elbow Method for Optimal k"</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of clusters"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Inertia"</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-31-output-1.png" width="610" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Visualization of Cluster wise amenities Distribution:</p>
<div id="19bd7ef5" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'amenities_count'</span>]]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Fit KMeans (e.g., with 3 clusters)</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'amenity_cluster'</span>] <span class="op">=</span> kmeans.fit_predict(X_scaled)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'amenity_cluster'</span>)[<span class="st">'amenities_count'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">amenity_cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>16320.0</td>
<td>57.557169</td>
<td>9.086436</td>
<td>47.0</td>
<td>51.0</td>
<td>55.0</td>
<td>62.0</td>
<td>118.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>22639.0</td>
<td>36.195415</td>
<td>5.817108</td>
<td>26.0</td>
<td>32.0</td>
<td>36.0</td>
<td>41.0</td>
<td>46.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>16065.0</td>
<td>15.637224</td>
<td>5.763904</td>
<td>1.0</td>
<td>11.0</td>
<td>16.0</td>
<td>20.0</td>
<td>25.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="528abe76" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose k = 3 based on elbow</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'amenity_cluster'</span>, y<span class="op">=</span><span class="st">'amenities_count'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Amenities Count per Cluster"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Amenity Cluster"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Number of Amenities"</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\riyap\AppData\Local\Temp\ipykernel_7460\232149940.py:5: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-33-output-2.png" width="667" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="fcbda270" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df, col<span class="op">=</span><span class="st">"amenity_cluster"</span>, height<span class="op">=</span><span class="dv">4</span>, aspect<span class="op">=</span><span class="fl">1.2</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(sns.histplot, x<span class="op">=</span><span class="st">"amenities_count"</span>, bins<span class="op">=</span><span class="dv">30</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"Amenities Count"</span>, <span class="st">"Listings"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">"Cluster </span><span class="sc">{col_name}</span><span class="st">"</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Distribution of Amenities in Each Cluster"</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-34-output-1.png" width="1372" height="408" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Cluster Characteristics:</strong></p>
<p>Cluster 0: Low-amenity listings (likely budget options)</p>
<p>Cluster 1: Medium-amenity, average-tier properties</p>
<p>Cluster 2: High-amenity listings (possibly premium or luxury)</p>
<section id="using-pca" class="level5">
<h5 class="anchored" data-anchor-id="using-pca">Using PCA:</h5>
<p>The selected features are scaled to standardize units (StandardScaler). PCA was applied to transform the data to 2 components (PC1, PC2). KMeans clustering was run for k=3, k=4, and k=5 to compare clustering structure.Each result was visualized using a scatterplot of PC1 vs PC2, with different colors for each cluster</p>
<div id="11a25b2a" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'amenities_count'</span>] <span class="op">=</span> df[<span class="st">'amenities'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(<span class="bu">str</span>(x).split(<span class="st">','</span>)))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Select &amp; Scale Features ---</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">'price'</span>, <span class="st">'latitude'</span>, <span class="st">'longitude'</span>, <span class="st">'amenities_count'</span>]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df[features].dropna()</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_filtered.copy()</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Apply PCA (2D Projection) ---</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>X_pca <span class="op">=</span> pca.fit_transform(X_scaled)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>pca_df <span class="op">=</span> pd.DataFrame(X_pca, columns<span class="op">=</span>[<span class="st">'PC1'</span>, <span class="st">'PC2'</span>])</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Cluster and Plot for k = 3, 4, 5 ---</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">5</span>))</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, k <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]):</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> kmeans.fit_predict(X_scaled)</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>pca_df[<span class="st">'PC1'</span>],</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>pca_df[<span class="st">'PC2'</span>],</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span>cluster_labels,</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span><span class="st">'tab10'</span>,</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>axs[i],</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    axs[i].set_title(<span class="ss">f'KMeans Clustering (k=</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    axs[i].set_xlabel(<span class="st">'Principal Component 1'</span>)</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    axs[i].set_ylabel(<span class="st">'Principal Component 2'</span>)</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"KMeans Clustering Comparison for k = 3, 4, 5"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-35-output-1.png" width="1718" height="494" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c0e1922d" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">6</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df_clusters <span class="op">=</span> df.copy()</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>df_clusters[<span class="st">'cluster'</span>] <span class="op">=</span> kmeans.fit_predict(X_scaled)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>pd.crosstab(df_clusters[<span class="st">'city'</span>], df_clusters[<span class="st">'cluster'</span>])</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>X_pca <span class="op">=</span> pca.fit_transform(X_scaled)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>pca_df <span class="op">=</span> pd.DataFrame(X_pca, columns<span class="op">=</span>[<span class="st">'PC1'</span>, <span class="st">'PC2'</span>])</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>pca_df[<span class="st">'cluster'</span>] <span class="op">=</span> df_clusters[<span class="st">'cluster'</span>]</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>pca_df[<span class="st">'city'</span>] <span class="op">=</span> df_clusters[<span class="st">'city'</span>]</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>pca_df, x<span class="op">=</span><span class="st">'PC1'</span>, y<span class="op">=</span><span class="st">'PC2'</span>, hue<span class="op">=</span><span class="st">'cluster'</span>, style<span class="op">=</span><span class="st">'city'</span>, palette<span class="op">=</span><span class="st">'tab10'</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'KMeans Market Segments (k=6) across Cities'</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Principal Component 1'</span>)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Principal Component 2'</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dss_files/figure-html/cell-36-output-1.png" width="947" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusions" class="level3">
<h3 class="anchored" data-anchor-id="conclusions">Conclusions:</h3>
<p>Pricing Drivers: Features such as number of bedrooms, accommodates, review scores, and availability windows strongly influence listing price. City-wise differences also play a major role in pricing behavior.</p>
<p>Modeling Insights:</p>
<p>Lasso Regression was useful for identifying key predictors with regularization.</p>
<p>Random Forest delivered the highest accuracy (lowest RMSE and highest R²), outperforming both linear and non-linear baselines.</p>
<p>City-level models revealed that local market characteristics matter, and tuning per city improved prediction accuracy.</p>
<p>Clustering Discoveries: K-Means clustering revealed meaningful listing segments based on amenities, price, and location. These insights can guide hosts in differentiating their offerings and platforms in tailoring search or recommendation features.</p>
<p>Data Quality &amp; Preprocessing: Outlier removal, feature engineering, and proper encoding were crucial for improving model performance and stability.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>